<?xml version="1.0" encoding="UTF-8"?>
<routing-policy
    xmlns="urn:ietf:params:xml:ns:yang:ietf-routing-policy">
  <defined-sets>
    <prefix-sets>
      <prefix-set>
        <name>L0andL1</name>
	<mode>ipv4</mode>
        <prefixes>
          <prefix-list>
            <ip-prefix>1.1.1.1/32</ip-prefix>
	    <mask-length-lower>32</mask-length-lower>
	    <mask-length-upper>32</mask-length-upper>
          </prefix-list>
          <prefix-list>
            <ip-prefix>2.2.2.2/32</ip-prefix>
	    <mask-length-lower>32</mask-length-lower>
	    <mask-length-upper>32</mask-length-upper>
          </prefix-list>
        </prefixes>
      </prefix-set>
      <prefix-set>
        <name>L2andL3</name>
	<mode>ipv4</mode>
        <prefixes>
          <prefix-list>
            <ip-prefix>3.3.3.3/32</ip-prefix>
	    <mask-length-lower>32</mask-length-lower>
	    <mask-length-upper>32</mask-length-upper>
          </prefix-list>
          <prefix-list>
            <ip-prefix>4.4.4.4/32</ip-prefix>
	    <mask-length-lower>32</mask-length-lower>
	    <mask-length-upper>32</mask-length-upper>
          </prefix-list>
        </prefixes>
      </prefix-set>
      <prefix-set>
        <name>L4</name>
	<mode>ipv4</mode>
        <prefixes>
          <prefix-list>
            <ip-prefix>5.5.5.5/32</ip-prefix>
	    <mask-length-lower>32</mask-length-lower>
	    <mask-length-upper>32</mask-length-upper>
          </prefix-list>
        </prefixes>
      </prefix-set>
    </prefix-sets>
  </defined-sets>
  <policy-definitions>
    <policy-definition>
      <name>TO_R2</name>
      <statements>
        <statement>
          <name>10</name>
          <conditions>
            <match-prefix-set>
              <prefix-set>L0andL1</prefix-set>
            </match-prefix-set>
          </conditions>
          <actions>
            <bgp-actions
                xmlns="urn:ietf:params:xml:ns:yang:ietf-bgp-policy">
              <set-community>
                <options>add</options>
                <communities>11:11</communities>
              </set-community>
            </bgp-actions>
          </actions>
        </statement>
        <statement>
          <name>20</name>
          <conditions>
            <match-prefix-set>
              <prefix-set>L2andL3</prefix-set>
            </match-prefix-set>
          </conditions>
          <actions>
            <bgp-actions
                xmlns="urn:ietf:params:xml:ns:yang:ietf-bgp-policy">
              <set-community>
                <options>remove</options>
                <communities>11:11</communities>
                <communities>22:22</communities>
              </set-community>
            </bgp-actions>
          </actions>
        </statement>
        <statement>
          <name>30</name>
          <conditions>
            <match-prefix-set>
              <prefix-set>L4</prefix-set>
            </match-prefix-set>
          </conditions>
          <actions>
            <bgp-actions
                xmlns="urn:ietf:params:xml:ns:yang:ietf-bgp-policy">
              <set-community>
                <options>replace</options>
                <communities>33:33</communities>
              </set-community>
            </bgp-actions>
          </actions>
        </statement>
      </statements>
    </policy-definition>
  </policy-definitions>
</routing-policy>

<routing
    xmlns="urn:ietf:params:xml:ns:yang:ietf-routing"
    xmlns:bt="urn:ietf:params:xml:ns:yang:iana-bgp-types">
  <control-plane-protocols>
    <control-plane-protocol>
      <type
          xmlns:bgp="urn:ietf:params:xml:ns:yang:ietf-bgp">bgp:bgp</type>
      <name>BGP</name>
      <bgp
          xmlns="urn:ietf:params:xml:ns:yang:ietf-bgp">
        <global>
          <as>1</as>
          <afi-safis>
            <afi-safi>
              <name>bt:ipv4-unicast</name>
            </afi-safi>
          </afi-safis>
        </global>
        <neighbors>
          <neighbor>
            <remote-address>10.1.1.2</remote-address>
            <peer-as>2</peer-as>
            <afi-safis>
              <afi-safi>
                <name>bt:ipv4-unicast</name>
              </afi-safi>
            </afi-safis>
            <send-community>bt:standard</send-community>
            <apply-policy>
              <export-policy>TO_R2</export-policy>
              <default-export-policy>accept-route</default-export-policy>
            </apply-policy>
          </neighbor>
        </neighbors>
      </bgp>
    </control-plane-protocol>
  </control-plane-protocols>
</routing>
